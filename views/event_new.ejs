<%-include ("./Include/Admin/head.ejs")%>

  <body>

    <%-include ("./Include/Admin/header.ejs")%>

      <!-- ======= Sidebar ======= -->
      <aside id="sidebar" class="sidebar">

        <ul class="sidebar-nav" id="sidebar-nav">

          <li class="nav-item">
            <a class="nav-link collapsed" href="/dashboard">
              <i class="bi bi-columns-gap"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <!-- End Dashboard Nav -->
          </li><!-- End Components Nav -->
          <li class="nav-item">
            <a class="nav-link collapsed" href="/student">
              <i class="bi bi-person-circle"></i>
              <span>Student Management</span>
            </a>
          </li><!-- End Error 404 Page Nav -->

          <li class="nav-item">
            <a class="nav-link collapsed" href="/attendance">
              <i class="bi bi-table"></i>

              <span>Attendance Management</span>
            </a>
          </li><!-- End Blank Page Nav -->
          <li class="nav-item">
            <a class="nav-link" href="/event">

              <i class="bi bi-calendar-event"></i>
              <span>Event Management</span>
            </a>
          </li><!-- End Blank Page Nav -->
        </ul>

      </aside><!-- End Sidebar-->
      <div class="main" id="main">
        <section class="section student">
          <div class="row">
            <div class="card">
              <div class="card-body">
                <form method="post" class="needs-validation" id="form" novalidate>
                  <h5 class="card-title">Insert New Event</h5>

                  <div class="col-md-12">
                    <div class="mb-2">
                      <label for="event_name" class="form-label fw-bold">Event Name</label>
                      <input type="text" class="form-control" id="event_name" name="event_name" required autofocus>
                      <div class="invalid-feedback">

                      </div>
                    </div>


                  </div>
                  <div class="col-md-12">
                    <div class="mb-2">
                      <label for="event_date" class="form-label fw-bold">Event Date</label>
                      <input type="date" class="form-control" id="event_date" name="event_date" required>
                      <div class="invalid-feedback">

                      </div>
                    </div>


                  </div>
                  <div class="col-md-12 mb-2">

                    <label for="attendance_type" class="form-label fw-bold">Attendance Type</label>
                    <select onchange="getval(this)" class="form-select" name="attendance_type" required>

                      <option value="WholeDay" selected>Whole Day</option>
                      <option value="MorningOnly">Morning Only</option>
                      <option value="AfternoonOnly">Afternoon Only</option>
                    </select>

                  </div>
                  <div class="col-md-12 mb-3">

                    <div id="morning_only" class="mb-2">

                      <div class="row">
                        <div class="col-md-6">
                          <label for="time_in_am_start" class="form-label fw-bold">Time In Start (AM)</label>
                          <input type="time" min="00:00" max="11:59" value="08:00" class="form-control"
                            id="time_in_am_start" name="time_in_am_start" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>

                        <div class="col-md-6">
                          <label for="time_in_am_end" class="form-label fw-bold">Time In End (AM)</label>
                          <input type="time" min="00:00" max="11:59" value="08:30" class="form-control"
                            id="time_in_am_end" name="time_in_am_end" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="time_out_am_start" class="form-label fw-bold">Time Out Start (AM)</label>
                          <input type="time" min="00:00" max="11:59" value="11:00" class="form-control"
                            id="time_out_am_start" name="time_out_am_start" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="time_out_am_end" class="form-label fw-bold">Time Out End (AM)</label>
                          <input type="time" min="00:00" max="11:59" value="11:30" class="form-control"
                            id="time_out_am_end" name="time_out_am_end" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                      </div>
                    </div>
                    <div id="afternoon_only" class="mb-2">

                      <div class="row">
                        <div class="col-md-6">
                          <label for="time_in_pm_start" class="form-label fw-bold">Time In Start (PM)</label>
                          <input type="time" min="12:00" max="24:00" value="13:00" class="form-control"
                            id="time_in_pm_start" name="time_in_pm_start" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="time_in_pm_end" class="form-label fw-bold">Time In End (PM)</label>
                          <input type="time" min="12:00" max="24:00" value="13:30" class="form-control"
                            id="time_in_pm_end" name="time_in_pm_end" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="time_out_pm_start" class="form-label fw-bold">Time Out Start (PM)</label>
                          <input type="time" min="12:00" max="24:00" value="16:30" class="form-control"
                            id="time_out_pm_start" name="time_out_pm_start" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="time_out_pm_end" class="form-label fw-bold">Time Out End (AM)</label>
                          <input type="time" min="12:00" max="24:00" value="17:00" class="form-control"
                            id="time_out_pm_end" name="time_out_pm_end" required>

                          <div class="invalid-feedback">

                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                  <div class="col-md-12">
                    <input type="submit" class="btn btn-success float-end" value="Add Event">
                  </div>
                </form>
              </div>
            </div>
          </div>

        </section>
      </div>


      <%-include ("./Include/Admin/script.ejs")%>
        <script>
          const Toast = Swal.mixin({
            width: 450,
            toast: true,
            position: "top",
            showConfirmButton: false,
            timer: 8000,
          })

          if ('<%-error_msg%>' != '') {

            Toast.fire({
              icon: 'error',
              title: "<%=error_msg%>"
            })

          }

          var today = new Date().toISOString().split('T')[0];
          document.getElementsByName("event_date")[0].setAttribute('min', today);


          function getval(el) {
            if (el.value === "WholeDay") {


              document.getElementById("time_in_am_start").removeAttribute("disabled")
              document.getElementById("time_in_am_end").removeAttribute("disabled")
              document.getElementById("time_out_am_start").removeAttribute("disabled")
              document.getElementById("time_out_am_end").removeAttribute("disabled")

              document.getElementById("time_in_pm_start").removeAttribute("disabled")
              document.getElementById("time_in_pm_end").removeAttribute("disabled")
              document.getElementById("time_out_pm_start").removeAttribute("disabled")
              document.getElementById("time_out_pm_end").removeAttribute("disabled")

              document.getElementById("morning_only").style.display = 'block'
              document.getElementById("afternoon_only").style.display = 'block'
            } else if (el.value === "MorningOnly") {


              document.getElementById("time_in_am_start").removeAttribute("disabled")
              document.getElementById("time_in_am_end").removeAttribute("disabled")
              document.getElementById("time_out_am_start").removeAttribute("disabled")
              document.getElementById("time_out_am_end").removeAttribute("disabled")

              document.getElementById("time_in_pm_start").setAttribute("disabled", "")
              document.getElementById("time_in_pm_end").setAttribute("disabled", "")
              document.getElementById("time_out_pm_start").setAttribute("disabled", "")
              document.getElementById("time_out_pm_end").setAttribute("disabled", "")

              document.getElementById("morning_only").style.display = 'block'
              document.getElementById("afternoon_only").style.display = 'none'
            } else if (el.value === "AfternoonOnly") {


              document.getElementById("time_in_am_start").setAttribute("disabled", "")
              document.getElementById("time_in_am_end").setAttribute("disabled", "")
              document.getElementById("time_out_am_start").setAttribute("disabled", "")
              document.getElementById("time_out_am_end").setAttribute("disabled", "")

              document.getElementById("time_in_pm_start").removeAttribute("disabled")
              document.getElementById("time_in_pm_end").removeAttribute("disabled")
              document.getElementById("time_out_pm_start").removeAttribute("disabled")
              document.getElementById("time_out_pm_end").removeAttribute("disabled")

              document.getElementById("morning_only").style.display = 'none'
              document.getElementById("afternoon_only").style.display = 'block'

            }
          }
          (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
              form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                  event.preventDefault()
                  event.stopPropagation()
                }

                form.classList.add('was-validated')
              }, false)
            })

          })()

          document.querySelector("form").addEventListener('submit', event => {
            var time_in_am_start = document.getElementById("time_in_am_start").value
            var time_in_am_end = document.getElementById("time_in_am_end").value

            var time_out_am_start = document.getElementById("time_out_am_start").value
            var time_out_am_end = document.getElementById("time_out_am_end").value

            var time_in_pm_start = document.getElementById("time_in_pm_start").value
            var time_in_pm_end = document.getElementById("time_in_pm_end").value

            var time_out_pm_start = document.getElementById("time_out_pm_start").value
            var time_out_pm_end = document.getElementById("time_out_pm_end").value

            if (time_in_am_start > time_in_am_end) {
              Toast.fire({
                icon: 'error',
                title: "Time In Start (AM) must not be greater than Time In End (AM)"
              })

              event.preventDefault()
              event.stopPropagation()
            }

            if (time_out_am_start > time_out_am_end) {
              Toast.fire({
                icon: 'error',
                title: "Time Out Start (AM) must not be greater than Time Out End (AM)"
              })

              event.preventDefault()
              event.stopPropagation()
            }


            if (time_in_pm_start > time_in_pm_end) {
              Toast.fire({
                icon: 'error',
                title: "Time In Start (PM) must not be greater than Time In End (PM)"
              })

              event.preventDefault()
              event.stopPropagation()
            }

            if (time_out_pm_start > time_out_pm_end) {
              Toast.fire({
                icon: 'error',
                title: "Time Out Start (PM) must not be greater than Time Out End (PM)"
              })

              event.preventDefault()
              event.stopPropagation()
            }



            return false
          })






        </script>


  </body>

  </html>