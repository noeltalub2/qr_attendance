<%-include ("./Include/Admin/head.ejs")%>

  <body>

    <%-include ("./Include/Admin/header.ejs")%>

      <!-- ======= Sidebar ======= -->
      <aside id="sidebar" class="sidebar">

        <ul class="sidebar-nav" id="sidebar-nav">

          <li class="nav-item">
            <a class="nav-link collapsed" href="/dashboard">
              <i class="bi bi-columns-gap"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <!-- End Dashboard Nav -->
          </li><!-- End Components Nav -->
          <li class="nav-item">
            <a class="nav-link collapsed" href="/student">
              <i class="bi bi-person-circle"></i>
              <span>Student Management</span>
            </a>
          </li><!-- End Error 404 Page Nav -->

          <li class="nav-item">
            <a class="nav-link collapsed" href="/attendance">
              <i class="bi bi-table"></i>

              <span>Attendance Management</span>
            </a>
          </li><!-- End Blank Page Nav -->
          <li class="nav-item">
            <a class="nav-link" href="/event">

              <i class="bi bi-calendar-event"></i>
              <span>Event Management</span>
            </a>
          </li><!-- End Blank Page Nav -->
          <li class="nav-heading">Others</li>


          <li class="nav-item">
            <a class="nav-link collapsed" href="/settings">

              <i class="bi bi-gear"></i>
              <span>Settings</span>
            </a>
          </li><!-- End Blank Page Nav -->
        </ul>

      </aside><!-- End Sidebar-->
      <div class="main" id="main">
        <div class="pagetitle">
          <h1>Edit Event</h1>
          <nav>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
              <li class="breadcrumb-item"><a href="/event">Event Management</a></li>

              <li class="breadcrumb-item active">Edit Event</li>
            </ol>
          </nav>
        </div>
        <section class="section student">

          <div class="row">
            <div class="col-lg-6">
              <div class="card">
                <div class="card-body">
                  <form method="post" action="/event/edit" class="needs-validation" id="form" novalidate>
                    <h5 class="card-title">Edit Event</h5>

                    <%-include ("./Include/Admin/message.ejs")%>



                      <div class="mb-0 row">
                        <label for="student_id" class="col-sm-3 col-form-label">Event Code:</label>
                        <div class="col-sm-9">
                          <input type="text" class="form-control-plaintext fw-bold" id="event_code" name="event_code"
                            value="<%=event_record.event_code%>" readonly>
                        </div>
                      </div>

                      <div class="mb-2 row">
                        <label for="student_id" class="col-sm-3 col-form-label">Event Date:</label>
                        <div class="col-sm-9">
                          <input type="text" class="form-control-plaintext fw-bold" id="event_date" name="event_date"
                            value="<%=event_record.event_date%>" readonly>
                        </div>
                      </div>


                      <div class="mb-2">
                        <label for="event_name" class="form-label fw-bold">Event Name</label>
                        <input type="text" class="form-control" id="event_name" name="event_name"
                          value="<%=event_record.event_name%>" required>
                        <div class="invalid-feedback">

                        </div>
                      </div>



                      <div class="mb-2">

                        <label for="attendance_type" class="form-label fw-bold">Attendance Type</label>
                        <select id="select_attendance" onchange="getval(this)" class="form-select"
                          name="attendance_type" required>


                          <option value="WholeDay">Whole Day</option>
                          <option value="MorningOnly">Morning Only</option>
                          <option value="AfternoonOnly">Afternoon Only</option>
                        </select>

                      </div>


                      <div id="morning_only" class="mb-2">

                        <div class="row">
                          <div class="col-md-6">
                            <label for="time_in_am_start" class="form-label fw-bold">Time In Start (AM)</label>
                            <input type="time" min="00:00" max="11:59" class="form-control" id="time_in_am_start"
                              name="time_in_am_start" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>

                          <div class="col-md-6">
                            <label for="time_in_am_end" class="form-label fw-bold">Time In End (AM)</label>
                            <input type="time" min="00:00" max="11:59" class="form-control" id="time_in_am_end"
                              name="time_in_am_end" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="time_out_am_start" class="form-label fw-bold">Time Out Start (AM)</label>
                            <input type="time" min="00:00" max="11:59" class="form-control" id="time_out_am_start"
                              name="time_out_am_start" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="time_out_am_end" class="form-label fw-bold">Time Out End (AM)</label>
                            <input type="time" min="00:00" max="11:59" class="form-control" id="time_out_am_end"
                              name="time_out_am_end" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                        </div>
                      </div>
                      <div id="afternoon_only" class="mb-2">

                        <div class="row">
                          <div class="col-md-6">
                            <label for="time_in_pm_start" class="form-label fw-bold">Time In Start (PM)</label>
                            <input type="time" min="12:00" max="24:00" class="form-control" id="time_in_pm_start"
                              name="time_in_pm_start" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="time_in_pm_end" class="form-label fw-bold">Time In End (PM)</label>
                            <input type="time" min="12:00" max="24:00" class="form-control" id="time_in_pm_end"
                              name="time_in_pm_end" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="time_out_pm_start" class="form-label fw-bold">Time Out Start (PM)</label>
                            <input type="time" min="12:00" max="24:00" class="form-control" id="time_out_pm_start"
                              name="time_out_pm_start" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="time_out_pm_end" class="form-label fw-bold">Time Out End (AM)</label>
                            <input type="time" min="12:00" max="24:00" class="form-control" id="time_out_pm_end"
                              name="time_out_pm_end" required>

                            <div class="invalid-feedback">

                            </div>
                          </div>
                        </div>
                      </div>


                      <div class="col-md-12">
                        <input type="submit" class="btn btn-success" value="Edit Event">
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>


        </section>
      </div>


      <%-include ("./Include/Admin/script.ejs")%>
        <script src="/vendor/moment/moment.js"></script>
        <script>
          const Toast = Swal.mixin({
            showClass: {
              // disable popup animation
              icon: ''                       // disable icon animation
            },

            toast: true,
            position: 'top',
            showConfirmButton: false,
            timer: 5000,
          })

          var today = new Date().toISOString().split("T")[0];
          document.getElementsByName("event_date")[0].setAttribute("min", today);



          document.querySelector("form").addEventListener("submit", (event) => {
            var time_in_am_start = document.getElementById("time_in_am_start").value;
            var time_in_am_end = document.getElementById("time_in_am_end").value;

            var time_out_am_start = document.getElementById("time_out_am_start").value;
            var time_out_am_end = document.getElementById("time_out_am_end").value;

            var time_in_pm_start = document.getElementById("time_in_pm_start").value;
            var time_in_pm_end = document.getElementById("time_in_pm_end").value;

            var time_out_pm_start = document.getElementById("time_out_pm_start").value;
            var time_out_pm_end = document.getElementById("time_out_pm_end").value;

            if (time_in_am_start > time_in_am_end) {
              Toast.fire({
                icon: "error",
                title: "Time In Start (AM) must not be greater than Time In End (AM)",
              });

              event.preventDefault();
              event.stopPropagation();
            }

            if (time_out_am_start > time_out_am_end) {
              Toast.fire({
                icon: "error",
                title: "Time Out Start (AM) must not be greater than Time Out End (AM)",
              });

              event.preventDefault();
              event.stopPropagation();
            }

            if (time_in_pm_start > time_in_pm_end) {
              Toast.fire({
                icon: "error",
                title: "Time In Start (PM) must not be greater than Time In End (PM)",
              });

              event.preventDefault();
              event.stopPropagation();
            }

            if (time_out_pm_start > time_out_pm_end) {
              Toast.fire({
                icon: "error",
                title: "Time Out Start (PM) must not be greater than Time Out End (PM)",
              });

              event.preventDefault();
              event.stopPropagation();
            }

            return false;
          });

        </script>
        <script>
          $(function () {
            document.getElementById("select_attendance").value = '<%-event_record.attendance_type%>';

            if ('<%-event_record.attendance_type%>' === "WholeDay") {
              document.getElementById("time_in_am_start").removeAttribute("disabled");
              document.getElementById("time_in_am_end").removeAttribute("disabled");
              document
                .getElementById("time_out_am_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_am_end").removeAttribute("disabled");

              document.getElementById("time_in_pm_start").removeAttribute("disabled");
              document.getElementById("time_in_pm_end").removeAttribute("disabled");
              document
                .getElementById("time_out_pm_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_pm_end").removeAttribute("disabled");

              document.getElementById("morning_only").style.display = "block";
              document.getElementById("afternoon_only").style.display = "block";
            } else if ('<%-event_record.attendance_type%>' === "MorningOnly") {
              document.getElementById("time_in_am_start").removeAttribute("disabled");
              document.getElementById("time_in_am_end").removeAttribute("disabled");
              document
                .getElementById("time_out_am_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_am_end").removeAttribute("disabled");

              document
                .getElementById("time_in_pm_start")
                .setAttribute("disabled", "");
              document.getElementById("time_in_pm_end").setAttribute("disabled", "");
              document
                .getElementById("time_out_pm_start")
                .setAttribute("disabled", "");
              document.getElementById("time_out_pm_end").setAttribute("disabled", "");

              document.getElementById("morning_only").style.display = "block";
              document.getElementById("afternoon_only").style.display = "none";
            } else if ('<%-event_record.attendance_type%>' === "AfternoonOnly") {
              document
                .getElementById("time_in_am_start")
                .setAttribute("disabled", "");
              document.getElementById("time_in_am_end").setAttribute("disabled", "");
              document
                .getElementById("time_out_am_start")
                .setAttribute("disabled", "");
              document.getElementById("time_out_am_end").setAttribute("disabled", "");

              document.getElementById("time_in_pm_start").removeAttribute("disabled");
              document.getElementById("time_in_pm_end").removeAttribute("disabled");
              document
                .getElementById("time_out_pm_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_pm_end").removeAttribute("disabled");

              document.getElementById("morning_only").style.display = "none";
              document.getElementById("afternoon_only").style.display = "block";
            }
          }
          );

          function getval(el) {


            if (el.value === "WholeDay") {
              document.getElementById("time_in_am_start").removeAttribute("disabled");
              document.getElementById("time_in_am_end").removeAttribute("disabled");
              document
                .getElementById("time_out_am_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_am_end").removeAttribute("disabled");

              document.getElementById("time_in_pm_start").removeAttribute("disabled");
              document.getElementById("time_in_pm_end").removeAttribute("disabled");
              document
                .getElementById("time_out_pm_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_pm_end").removeAttribute("disabled");

              document.getElementById("morning_only").style.display = "block";
              document.getElementById("afternoon_only").style.display = "block";
            } else if (el.value === "MorningOnly") {
              document.getElementById("time_in_am_start").removeAttribute("disabled");
              document.getElementById("time_in_am_end").removeAttribute("disabled");
              document
                .getElementById("time_out_am_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_am_end").removeAttribute("disabled");

              document
                .getElementById("time_in_pm_start")
                .setAttribute("disabled", "");
              document.getElementById("time_in_pm_end").setAttribute("disabled", "");
              document
                .getElementById("time_out_pm_start")
                .setAttribute("disabled", "");
              document.getElementById("time_out_pm_end").setAttribute("disabled", "");

              document.getElementById("morning_only").style.display = "block";
              document.getElementById("afternoon_only").style.display = "none";
            } else if (el.value === "AfternoonOnly") {
              document
                .getElementById("time_in_am_start")
                .setAttribute("disabled", "");
              document.getElementById("time_in_am_end").setAttribute("disabled", "");
              document
                .getElementById("time_out_am_start")
                .setAttribute("disabled", "");
              document.getElementById("time_out_am_end").setAttribute("disabled", "");

              document.getElementById("time_in_pm_start").removeAttribute("disabled");
              document.getElementById("time_in_pm_end").removeAttribute("disabled");
              document
                .getElementById("time_out_pm_start")
                .removeAttribute("disabled");
              document.getElementById("time_out_pm_end").removeAttribute("disabled");

              document.getElementById("morning_only").style.display = "none";
              document.getElementById("afternoon_only").style.display = "block";
            }
          }

          const convertTime12to24 = (time12h) => moment(time12h, 'hh:mm A').format('HH:mm');

          document.getElementById("time_in_am_start").value = convertTime12to24(
            "<%-event_record.time_in_am_start%>"
          );
          document.getElementById("time_in_am_end").value = convertTime12to24(
            "<%-event_record.time_in_am_end%>"
          );
          document.getElementById("time_out_am_start").value = convertTime12to24(
            "<%-event_record.time_out_am_start%>"
          );
          document.getElementById("time_out_am_end").value = convertTime12to24(
            "<%-event_record.time_out_am_end%>"
          );

          document.getElementById("time_in_pm_start").value = convertTime12to24(
            "<%-event_record.time_in_pm_start%>"
          );
          document.getElementById("time_in_pm_end").value = convertTime12to24(
            "<%-event_record.time_in_pm_end%>"
          );
          document.getElementById("time_out_pm_start").value = convertTime12to24(
            "<%-event_record.time_out_pm_start%>"
          );
          document.getElementById("time_out_pm_end").value = convertTime12to24(
            "<%-event_record.time_out_pm_end%>"
          );</script>


  </body>

  </html>