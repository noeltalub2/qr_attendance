<%-include ("./Include/Index/main_head.ejs")%>
	<%-include ("./Include/Index/main_header.ejs")%>

		<body>

			<main id="main">

				<div class="container-lg">

					<div class="page-header pt-3">
						<!-- <div class="row mb-md-1">
							<div class="col-12 col-lg-8 text-start">
								<h5 class="fw-bold">Event Name: 45th MMSU Foundation</h5>
								

							</div>
						</div> -->
					</div>
					<div class="page-content">

						<div class="row g-2">

							<div class="col-lg-4">
								<div class="card mb-2">
									<div class="card-body text-center">
										<div id="reader"></div>
									</div>
								</div>
							</div>
							<div class="col-lg-8">
								<div class="card mb-2">
									<div class="card-body">
										<!-- <h5 class="mb-3 fw-bold">Student Information</h5> -->
										<div class="col-md-12">
											<form>
												<div class="mb-3">
													<label for="student_id" class="form-label fw-bold">Student
														ID</label>
													<input class="form-control" type="text" name="student_id" value=""
														id="student_id" autofocus></input>
												</div>

												<div class="mb-3">
													<label for="student_name" class="form-label fw-bold">Student
														Name</label>
													<input class="form-control" type="text" name="student_name" value=""
														id="student_name"></input>
												</div>
												<div class="mb-3">
													<label for="section" class="form-label fw-bold">Section</label>

													<input class="form-control" type="text" name="student_section"
														value="" id="student_section"></input>

												</div>
												<div class="mb-3">
													<label for="course" class="form-label fw-bold">Course</label>
													<input class="form-control" type="text" name="student_course"
														value="" id="student_course"></input>
												</div>



												<input class="btn btn-primary" id="register" type="submit"
													value="Register"></input>

											</form>

										</div>

									</div>

								</div>

							</div>
						</div>

					</div>

				</div>

			</main>


		</body>

		<%-include ("./Include/Index/main_footer.ejs")%>
			<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
			<script src="/js/html5-qrcode.js" type="text/javascript"></script>
			<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

			<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
			<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
			<script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>

			<script type="text/javascript">

				const Toast = Swal.mixin({
					width: 450,
					toast: true,
					position: "top-end",
					showConfirmButton: false,
					timer: 5000,
				})



				let qrboxFunction = function (viewfinderWidth, viewfinderHeight) {
					let minEdgePercentage = .9; // 80%
					let minEdgeSize = Math.min(viewfinderWidth, viewfinderHeight);
					let qrboxSize = Math.floor(minEdgeSize * minEdgePercentage);
					return {
						width: qrboxSize,
						height: qrboxSize,
					};
				};
				let config = {
					qrbox: qrboxFunction,
					fps: 15,
					rememberLastUsedCamera: true,
					aspectRatio: 1.3,
					supportedScanTypes: [0],
				};

				var lastResult;

				function scanSuccess(decodedText, decodedResult) {
					if (decodedText !== lastResult) {
						lastResult = decodedText;
						const student_data = decodedText

						const studentArr = student_data.split(", ");

						document.querySelector("#student_id").value = studentArr[0] //student id data
						document.querySelector("#student_name").value = studentArr[1] //student id name
						document.querySelector("#student_section").value = studentArr[2] //student id year
						document.querySelector("#student_course").value = studentArr[3] //student id course

					}
				}

				let html5QrcodeScanner = new Html5QrcodeScanner("reader", config, false);

				html5QrcodeScanner.render(scanSuccess);



				$(document).ready(function () {
					$('form').on('submit', function (event) {
						event.preventDefault();
						var student = new Array();
						student.push(document.getElementById("student_id").value);
						student.push(document.getElementById("student_name").value);
						student.push(document.getElementById("student_course").value)
						student.push(document.getElementById("student_section").value)

						console.log(student)
						fetch("/insert", {
							method: "POST",
							body: JSON.stringify({ data: student }),
							headers: { "Content-Type": "application/json" },
						}).then((res => res.json())).then((response => {


							if (response.status === "success") {
								Toast.fire({
									icon: 'success',
									title: "Created Successfully"
								})
								document.querySelector("#student_id").value = "" //student id data
								document.querySelector("#student_name").value = "" //student id name
								document.querySelector("#student_section").value = "" //student id year
								document.querySelector("#student_course").value = "" //student id course
							} else {
								Toast.fire({
									icon: 'error',
									title: "Already Registered"
								})
							}
						}))
					})

				})


			</script>


			</body>

			</html>